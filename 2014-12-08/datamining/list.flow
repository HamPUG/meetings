# Project: adams
# Date: 2014-12-09 16:25:19
# User: fracpete
#
adams.flow.control.Flow
	-actor
		adams.flow.standalone.CallableActors
			-actor
				adams.flow.source.WekaClassifierSetup
					-name
					zeror
					-classifier
						weka.classifiers.rules.ZeroR
			-actor
				adams.flow.source.WekaClassifierSetup
					-name
					j48
					-classifier
						weka.classifiers.trees.J48
							-C
							0.25
							-M
							2
	-actor
		adams.flow.source.Start
	-actor
		adams.flow.control.Trigger
			-name
			init spreadsheet
			-tee
				adams.flow.source.NewSpreadSheet
					-columns
					entry,email,content
					-data-row-type
						adams.data.spreadsheet.DenseDataRow
					-spreadsheet-type
						adams.data.spreadsheet.SpreadSheet
			-tee
				adams.flow.transformer.SetStorageValue
					-storage-name
					sheet
	-actor
		adams.flow.control.Trigger
			-name
			select directory with archive files
			-tee
				adams.flow.source.SelectDirectory
					-stop-if-canceled
					true
					-dir-chooser-title
					Select archive dir
			-tee
				adams.flow.transformer.SetVariable
					-var-name
					dir
	-actor
		adams.flow.control.Trigger
			-name
			traverse files
			-tee
				adams.flow.source.FileSystemSearch
					-search
						adams.flow.source.filesystemsearch.FileSearch
							-directory
							@{dir}
							-regexp
							.*.txt.gz
							-sorting
							SORT_BY_NAME
			-tee
				adams.flow.control.Tee
					-name
					file name
					-tee
						adams.flow.transformer.BaseName
							-remove-extensions
							true
					-tee
						adams.flow.transformer.SetVariable
							-var-name
							filename
			-tee
				adams.flow.transformer.SetVariable
					-name
					reset counter
					-var-name
					count
					-var-value
					0
			-tee
				adams.flow.transformer.TextFileReader
					-reader
						adams.data.io.input.GzippedTextFileReader
							-text-reader
								adams.data.io.input.SingleStringTextReader
			-tee
				adams.flow.transformer.StringSplit
					-expression
					From .*
			-tee
				adams.flow.transformer.ArrayToSequence
			-tee
				adams.flow.transformer.IncVariable
					-var-name
					count
			-tee
				adams.flow.transformer.StringTrim
			-tee
				adams.flow.control.Tee
					-name
					content
					-tee
						adams.flow.transformer.StringSplit
							-expression
							\n
					-tee
						adams.flow.transformer.StringMatcher
							-regexp
							From: .*
							-invert
							true
					-tee
						adams.flow.control.ArrayProcess
							-actor
								adams.flow.transformer.StringReplace
									-find
									(\"|\'|,)
									-replace
									 
									-type
									ALL
					-tee
						adams.flow.transformer.StringJoin
							-glue
							\n
					-tee
						adams.flow.transformer.SetVariable
							-name
							content
							-var-name
							content
					-tee
						adams.flow.transformer.StringLength
					-tee
						adams.flow.transformer.SetVariable
							-var-name
							content_length
			-tee
				adams.flow.control.Trigger
					-name
					entry name
					-tee
						adams.flow.source.CombineVariables
							-expression
							@{filename}-@{count}
					-tee
						adams.flow.transformer.SetVariable
							-var-name
							entry
			-tee
				adams.flow.control.Tee
					-name
					extract email
					-tee
						adams.flow.transformer.StringSplit
							-expression
							\n
					-tee
						adams.flow.transformer.StringMatcher
							-regexp
							^From: .*$
					-tee
						adams.flow.transformer.StringReplace
							-find
							From: 
							-type
							ALL
					-tee
						adams.flow.transformer.StringTrim
					-tee
						adams.flow.transformer.StringJoin
							-glue
							 
					-tee
						adams.flow.transformer.SetVariable
							-var-name
							email
					-tee
						adams.flow.transformer.StringLength
					-tee
						adams.flow.transformer.SetVariable
							-name
							SetVariable-1
							-var-name
							email_length
			-tee
				adams.flow.transformer.StringReplace
					-find
					^From: .*$
					-type
					ALL
			-tee
				adams.flow.control.Continue
					-condition
						adams.flow.condition.bool.Expression
							-expression
							(@{content_length} = 0) or (@{email_length} = 0)
			-tee
				adams.flow.control.Trigger
					-name
					append spreadsheet
					-tee
						adams.flow.source.StorageValue
							-storage-name
							sheet
					-tee
						adams.flow.transformer.SpreadSheetInsertRow
							-no-copy
							true
							-after
							true
					-tee
						adams.flow.transformer.SpreadSheetSetCell
							-name
							entry
							-no-copy
							true
							-row
							last
							-col
							entry
							-value
							@{entry}
							-force-string
							true
					-tee
						adams.flow.transformer.SpreadSheetSetCell
							-name
							email
							-no-copy
							true
							-row
							last
							-col
							email
							-value
							@{email}
							-force-string
							true
					-tee
						adams.flow.transformer.SpreadSheetSetCell
							-name
							content
							-no-copy
							true
							-row
							last
							-col
							content
							-value
							@{content}
							-force-string
							true
					-tee
						adams.flow.transformer.SetStorageValue
							-storage-name
							sheet
			-tee
				adams.flow.sink.HistoryDisplay
					-entry-name-variable
					entry
	-actor
		adams.flow.control.Trigger
			-name
			display spreadsheet
			-tee
				adams.flow.source.StorageValue
					-storage-name
					sheet
			-tee
				adams.flow.sink.SpreadSheetDisplay
					-x
					-3
					-writer
						adams.data.io.output.NullWriter
	-actor
		adams.flow.control.Trigger
			-name
			baseline
			-tee
				adams.flow.source.StorageValue
					-storage-name
					sheet
			-tee
				adams.flow.transformer.Convert
					-conversion
						adams.data.conversion.SpreadSheetToWekaInstances
			-tee
				adams.flow.transformer.WekaFilter
					-filter
						weka.filters.MultiFilter
							-F
							weka.filters.unsupervised.attribute.Remove -R 1
							-F
							weka.filters.unsupervised.attribute.StringToNominal -R 1
							-F
							weka.filters.unsupervised.attribute.StringToWordVector -R last -P att- -W 1000 -prune-rate -1.0 -N 0 -stemmer weka.core.stemmers.NullStemmer -M 1 -tokenizer "weka.core.tokenizers.WordTokenizer -delimiters \" \\r\\n\\t.,;:\\\'\\\"()?!\""
			-tee
				adams.flow.transformer.WekaClassSelector
					-class
					first
			-tee
				adams.flow.transformer.WekaCrossValidationEvaluator
					-output
						weka.classifiers.evaluation.output.prediction.Null
					-classifier
					zeror
			-tee
				adams.flow.transformer.WekaEvaluationSummary
			-tee
				adams.flow.sink.Display
					-name
					baseline
					-short-title
					true
					-y
					-3
					-writer
						adams.data.io.output.NullWriter
	-actor
		adams.flow.control.Trigger
			-name
			j48
			-tee
				adams.flow.source.StorageValue
					-storage-name
					sheet
			-tee
				adams.flow.transformer.Convert
					-conversion
						adams.data.conversion.SpreadSheetToWekaInstances
			-tee
				adams.flow.transformer.WekaFilter
					-filter
						weka.filters.MultiFilter
							-F
							weka.filters.unsupervised.attribute.Remove -R 1
							-F
							weka.filters.unsupervised.attribute.StringToNominal -R 1
							-F
							weka.filters.unsupervised.attribute.StringToWordVector -R last -P att- -W 1000 -prune-rate -1.0 -N 0 -stemmer weka.core.stemmers.NullStemmer -M 1 -tokenizer "weka.core.tokenizers.WordTokenizer -delimiters \" \\r\\n\\t.,;:\\\'\\\"()?!\""
			-tee
				adams.flow.transformer.WekaClassSelector
					-class
					first
			-tee
				adams.flow.transformer.WekaCrossValidationEvaluator
					-output
						weka.classifiers.evaluation.output.prediction.Null
					-classifier
					j48
			-tee
				adams.flow.transformer.WekaEvaluationSummary
			-tee
				adams.flow.sink.Display
					-name
					j48
					-short-title
					true
					-x
					-3
					-y
					-3
					-writer
						adams.data.io.output.NullWriter
	-flow-execution-listener
		adams.flow.execution.NullListener

